# Set Static IP on Ubuntu

## Problem
* Ubuntu Server's Installed with DHCP Enabled
* Need to Use Static IP Now

## Get the Ethernet Interface that We Want to Configure IP for

```
ip a

// Output:
1: lo: ......
2: eno1: ......
3: wlp0s20f3: ......
```

In this case, `enp0s31f6` is the ethernet interface.

## Disable CloudInit
`/etc/netplan/50-cloud-init.yaml` is generated by CloudInit.
> Change to this file will not persist accross an instance reboot.

It's better NOT edit this `/etc/netplan/50-cloud-init.yaml` but disable CloudInit by creating an empty `cloud-init.disabled` under `/etc/cloud/`.

```bash
sudo touch /etc/cloud/cloud-init.disabled
```

## Create a new netpan configure file

```bash
sudo vi /etc/netplan/99-custom-network.yaml
```

```bash
network:
  ethernets:
    eno1:
      # Set stasic IP
      addresses:
        - 10.0.10.155/24
      routes:
        - to: default
          via: 10.0.10.1
      nameservers:
        addresses:
          - 223.5.5.5
          - 223.6.6.6
      # Add optional: true
      # to avoid waiting a long time on boot if the device is down
      optional: true
  version: 2
```

* Set permissions of the yaml file
It'll "prompts Netplan configuration should NOT be accessible by others."
when run `sudo netplan try` or `sudo netplan apply` if use open permissions.
Set it to `600`.

```bash
sudo chmod 600 /etc/netplan/99-custom-network.yaml
```

* Try to Apply New `netplan` Settings 

  ```bash
  sudo netplan try --timeout 5
  ```

* Apply directly

  ```bash
  sudo netplay apply
  ```

## References
* [How to Configure Static IP Address on Ubuntu 20.04](https://www.rosehosting.com/blog/how-to-configure-static-ip-address-on-ubuntu-20-04/)
* [netplan generate: `gateway4` has been deprecated, use default routes instead](https://unix.stackexchange.com/questions/681220/netplan-generate-gateway4-has-been-deprecated-use-default-routes-instead)
* [Ubuntu netplan gateway4 has been deprecated](https://tizutech.com/ubuntu-netplan-gateway4-has-been-deprecated/)
* [A start job is running for wait for network to be configured. Ubuntu server 17.10](https://askubuntu.com/questions/972215/a-start-job-is-running-for-wait-for-network-to-be-configured-ubuntu-server-17-1)
* [How to setup a static IP on Ubuntu Server 18.04](https://askubuntu.com/questions/1029531/how-to-setup-a-static-ip-on-ubuntu-server-18-04)
* [Netplan network configuration tutorial for beginners](https://linuxconfig.org/netplan-network-configuration-tutorial-for-beginners)
